!function(){function t(t,e){this.element=t,this.settings=this._mergeSettings(e),this._render(),this.settings.radius=Math.round(this.drum.offsetHeight/2/Math.tan(Math.PI/this.settings.panelCount)),this._renderData(),"undefined"!=typeof Hammer&&this._configureHammer(),this.settings.interactive&&this._configureEvents()}t.prototype={setIndex:function(e){if(e===this.getIndex())return void this._transform(!1);var i=Math.floor(e/this.settings.panelCount),n=e-i*this.settings.panelCount,s=new t.PanelModel(n,e,this.settings);this._update(s),this.settings.rotation=n*this.settings.theta,this._transform(!1)},getIndex:function(){return this._getSelected()?this._getSelected().dataModel.index:null},updateItems:function(e){return this.element.parentNode.removeChild(this.wrapper),this.settings.data=e,new t(this.element,this.settings)},_mergeSettings:function(t){t=t||{};var e,i={transformProp:this._getTransformProperty(),panelCount:16,rotateFn:"rotateX",interactive:!0,dial_w:20,dial_h:5,dial_stroke_color:"#999999",dial_stroke_width:1,initselect:void 0,mapping:[]};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);if(i.rotation=0,i.distance=0,i.last_angle=0,i.theta=360/i.panelCount,i.initselect=i.initselect||this.element.selectedIndex,!i.data){i.data=[];for(var n=0;n<this.element.children.length;n++)i.data.push(this.element.children[n].textContent)}return i},_getTransformProperty:function(){for(var t=!1,e="transform WebkitTransform MozTransform OTransform msTransform".split(" "),i=0;i<e.length;i++)void 0!==document.createElement("div").style[e[i]]&&(t=e[i]);return t||"transform"},_render:function(){var e,i,n,s,a,r;this.element.style.display="none",this.wrapper=e=document.createElement("div"),e.classList.add("drum-wrapper"),this.settings.id?e.setAttribute("id",this.settings.id):this.element.id?e.setAttribute("id","drum_"+this.element.id):this.element.hasAttribute("name")&&e.setAttribute("id","drum_"+this.element.getAttribute("name")),this.inner=i=document.createElement("div"),i.classList.add("inner"),e.appendChild(i),this.container=n=document.createElement("div"),n.classList.add("container"),i.appendChild(n),this.drum=r=document.createElement("div"),r.classList.add("drum"),n.appendChild(r),!0===this.settings.interactive&&(this.dialUp=s=t.DrumIcon.up(this.settings),e.appendChild(s),this.dialDown=a=t.DrumIcon.down(this.settings),e.appendChild(a)),this.element.parentNode.insertBefore(e,this.element.nextSibling)},_renderData:function(){var e,i;for(i=0,e=0;i<this.settings.panelCount&&this.settings.data.length!==i;i++){var n=e;e>=this.settings.panelCount/2&&(n=this.settings.data.length-(this.settings.panelCount-e)),e++;var s=new t.PanelModel(i,n,this.settings);s.init(),this.settings.mapping.push(s),this.drum.appendChild(s.elem)}},_getNearest:function(t){t=t||this.settings.rotation;var e=this.settings.theta/2,i=((t+e)%360+360)%360;i-=i%this.settings.theta;var n=(this.settings.data.length-1)*this.settings.theta;return i>n?t>0?n:0:i},_getSelected:function(){var t=this._getNearest();for(var e in this.settings.mapping)if(this.settings.mapping[e].angle===t)return this.settings.mapping[e];return-1},_update:function(t){for(var e,i=[],n=this.settings.panelCount,s=this.settings.panelCount/2,a=this.settings.data.length,r=t.index,d=t.dataModel.index,h=d-s;h<=d+s-1;h++)e=h,h<0&&(e=a+h),h>a-1&&(e=h-a),i.push(e);var o=i.slice(s-r);for(i=o.concat(i.slice(0,n-o.length)),r=0;r<this.settings.mapping.length;r++)this.settings.mapping[r].update(i[r])},_getTransformCss:function(t,e,i){return"translateZ(-"+t+"px) "+e+"("+i+"deg)"},_transform:function(t){this.drum.style[this.settings.transformProp]=this._getTransformCss(this.settings.radius,this.settings.rotateFn,this.settings.rotation);var e=this._getSelected();if(e){var i=e.dataModel,n=this.element.selectedIndex;this.element.selectedIndex=i.index,t&&n!==i.index&&this.settings.onChange&&this.settings.onChange(i.index);for(var s=this.drum.querySelectorAll("figure"),a=0;a<s.length;a++)s[a].classList.remove("active");e.elem.classList.add("active"),e.angle!==this.settings.last_angle&&[0,90,180,270].indexOf(e.angle)>=0&&(this.settings.last_angle=e.angle,this._update(e))}},_configureHammer:function(){var t,e,i=0,n=new Hammer(this.wrapper,{prevent_default:!0,no_mouseevents:!0});n.on("dragstart",function(){this.settings.distance=0,e=!0,t||(t=setInterval(function(){this.settings.rotation=(this.settings.rotation+i+360)%360,i/=e?1.1:1.03,!e&&Math.pow(i,2)<.001?(clearInterval(t),t=null):!e&&Math.pow(i,2)<.5&&Math.pow(this.settings.rotation-this._getNearest(),2)<.1&&(this.settings.rotation=this._getNearest(),clearInterval(t),t=null,i=0),this._transform(!0)}.bind(this),20))}.bind(this)),n.on("drag",function(t){i+=-1*Math.round(t.gesture.deltaY-this.settings.distance)/25,this.settings.distance=t.gesture.deltaY}.bind(this)),n.on("dragend",function(){e=!1;var t=this.settings.rotation-this._getNearest();t>180&&(t=360-t),Math.pow(i,2)<.5&&(i=t/-20)}.bind(this))},_configureEvents:function(){this.dialUp.addEventListener("click",function(){var t=this.settings.rotation+this.settings.theta+1;this.settings.rotation=this._getNearest(t),this._transform(!0)}.bind(this)),this.dialDown.addEventListener("click",function(){var t=this.settings.rotation-this.settings.theta-1;this.settings.rotation=this._getNearest(t),this._transform(!0)}.bind(this)),this.wrapper.addEventListener("mouseover",function(){this.dialUp.style.display="block",this.dialDown.style.display="block"}.bind(this)),this.wrapper.addEventListener("mouseout",function(){this.dialUp.style.display="none",this.dialDown.style.display="none"}.bind(this))}},this.Drum=t}(),function(){var t=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},e=function(e,i){var n=t("svg");n.setAttribute("width",e),n.setAttribute("height",i);var s=t("g");return n.appendChild(s),n},i=function(t){var e=document.createElement("div");e.setAttribute("class",t);var i=document.createElement("div");return e.appendChild(i),e},n=function(e){var i=t("path"),n={fill:"none",stroke:e.dial_stroke_color,"stroke-width":e.dial_stroke_width+"px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-opacity":"1"};for(var s in n)i.setAttribute(s,n[s]);return i};this.Drum.DrumIcon={up:function(t){var s=t.dial_w,a=t.dial_h,r=e(s,a),d=n(t);d.setAttribute("d","m0,"+(a+t.dial_stroke_width)+"l"+s/2+",-"+a+"l"+s/2+","+a),r.firstChild.appendChild(d);var h=i("dial up");return h.firstChild.appendChild(r),h},down:function(t){var s=t.dial_w,a=t.dial_h,r=e(s,a),d=n(t);d.setAttribute("d","m0,-"+t.dial_stroke_width+"l"+s/2+","+a+"l"+s/2+",-"+a),r.firstChild.appendChild(d);var h=i("dial down");return h.firstChild.appendChild(r),h}}}(),function(){function t(t,e,i){this.index=t,this.dataModel=new function(t,e){this.data=t,this.index=e,this.getText=function(){return this.data[this.index]}}(i.data,e),this.init=function(){this.angle=i.theta*t,this.elem=document.createElement("figure"),this.elem.classList.add("a"+100*this.angle),this.elem.style[i.transformProp]=i.rotateFn+"("+-this.angle+"deg) translateZ("+i.radius+"px)",this.setText()},this.setText=function(){this.elem.innerHTML=this.dataModel.getText()},this.update=function(t){this.dataModel.index!==t&&(this.dataModel.index=t,this.setText())}}this.Drum.PanelModel=t}();