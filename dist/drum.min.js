!function(){function t(t,i){if(this.element=t,this.settings=this._mergeSettings(i),this.transformProp=this._getTransformProperty(),this._render(),this.settings.interactive){"undefined"!=typeof Hammer&&e?this._configureHammer():this._configureEvents()}this.setIndex(this.settings.index,!1)}var e="ontouchstart"in window||navigator.msMaxTouchPoints>0;t.prototype={setIndex:function(t,e){var i=this.settings.data.length;t>i?t%=i:t<0&&(t=i-Math.abs(t)%i),this.index=t,this.updateDisplay(),void 0===e&&(e=!0),this._sync(e)},getIndex:function(){return this.index},getSelected:function(){return this._getItem(this.index).value},updateDisplay:function(){for(var t=this._getVisibleItems(this.index),e=this.drum.children,i=e.length,n=0;n<i;n++)this._updateDrumItem(e[n],t[n])},_mergeSettings:function(t){t=t||{};var e,i={radius:80,wedgeHeight:30,rotateFn:"rotateX",interactive:!0,dial_w:20,dial_h:10,dial_stroke_color:"#999999",dial_stroke_width:1,index:this.element.selectedIndex,onChange:null};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i.data=i.data||this._getDataFromChildren(),"number"!=typeof i.index&&(i.index=0),i},_getDataFromChildren:function(){for(var t=[],e=0;e<this.element.children.length;e++){var i=this.element.children[e];t.push({value:i,label:i.textContent})}return t},_getTransformProperty:function(){for(var t=!1,e="transform WebkitTransform MozTransform OTransform msTransform".split(" "),i=0;i<e.length;i++)void 0!==document.createElement("div").style[e[i]]&&(t=e[i]);return t||"transform"},_render:function(){var t,i,n,s;this.element.style.display="none",this.wrapper=t=document.createElement("div"),t.classList.add("drum-wrapper"),this.settings.interactive&&t.classList.add(e?"touch-enabled":"touch-disabled"),this.settings.id?t.setAttribute("id",this.settings.id):this.element.id?t.setAttribute("id","drum_"+this.element.id):this.element.hasAttribute("name")&&t.setAttribute("id","drum_"+this.element.getAttribute("name")),this.inner=i=document.createElement("div"),i.classList.add("inner"),t.appendChild(i),this.container=n=document.createElement("div"),n.classList.add("container"),i.appendChild(n),this.drum=s=document.createElement("div"),s.classList.add("drum"),n.appendChild(s),!0===this.settings.interactive&&this._createDialButtons(),this.element.parentNode.insertBefore(t,this.element.nextSibling);for(var r=this._calculateTotalWedges(),a=0;a<r;a++){var d=document.createElement("div");d.classList.add("drum-item"),s.appendChild(d)}this._applyTransformations()},_createDialButtons:function(){var e=this.settings.dial_w,i=this.settings.dial_h,n=this.settings.dial_stroke_color,s=this.settings.dial_stroke_width;this.dialUp=t.UpButton(e,i,n,s),this.wrapper.appendChild(this.dialUp),this.dialDown=t.DownButton(e,i,n,s),this.wrapper.appendChild(this.dialDown)},_calculateTotalWedges:function(){var t=this.settings.radius,e=this.settings.wedgeHeight,i=2*Math.PI/(e/t);return Math.max(1,Math.floor(i))},_getVisibleItems:function(t){var e,i=[],n=this.drum.children.length,s=Math.floor(n/2);for(e=0;e<s;e++)i.push(this._getItem(e+t));for(e=n-s;e>0;e--)i.push(this._getItem(t-e));return i},_getItem:function(t){var e=this.settings.data.length;return t<0?t=e+t:t>=e&&(t-=e),this.settings.data[t]},_updateDrumItem:function(t,e){t.textContent=(e||{}).label||""},_getDrumTransformation:function(t,e,i){return"translateZ(-"+t+"px) "+e+"("+i+"deg)"},_getItemTransformation:function(t,e,i){return e+"("+i+"deg) translateZ(-"+t+"px) "},_applyTransformations:function(){this._rotateDrum(0);for(var t=this.drum.children.length,e=360/t,i=0;i<t;i++){this.drum.children[i].style[this.transformProp]=this._getItemTransformation(this.settings.radius,this.settings.rotateFn,i*e)}},_rotateDrum:function(t){this.drum.style[this.transformProp]=this._getDrumTransformation(this.settings.radius,this.settings.rotateFn,t)},_configureHammer:function(){var t=new Hammer.Pan({direction:Hammer.DIRECTION_VERTICAL}),e=new Hammer.Manager(this.drum);e.add(t),e.on("pan panstart panend",function(t){var e=t.deltaY/this.settings.radius;if(e=180*e/Math.PI,this._rotateDrum(e),console.log(t.type),"panstart"===t.type)this.wrapper.classList.add("rotating");else if("panend"===t.type){var i=-Math.round(t.deltaY/this.settings.wedgeHeight);this.setIndex(this.index+i),this._rotateDrum(0),this.wrapper.classList.remove("rotating")}}.bind(this))},_configureEvents:function(){this.dialUp.addEventListener("click",function(){this.setIndex(this.getIndex()-1)}.bind(this)),this.dialDown.addEventListener("click",function(){this.setIndex(this.getIndex()+1)}.bind(this)),this.wrapper.addEventListener("wheel",function(t){var e=this.index+(t.wheelDelta<0?-1:1);this.setIndex(e)}.bind(this))},_sync:function(t){var e=this._getItem(this.index),i=e.value;i instanceof HTMLOptionElement?i.selected=!0:i instanceof HTMLElement&&i.classList.add("selected"),t&&this._fireChangeEvent(i)},_fireChangeEvent:function(){var t;try{t=new Event("change")}catch(e){t=document.createEvent("Event"),t.initEvent("change",!0,!1)}this.settings.onChange&&this.settings.onChange.call(this,t),this.element.dispatchEvent&&this.element.dispatchEvent(t)}},this.Drum=t}(),function(){function t(t,e){this._createSVGCanvas(t,e)}t.prototype={getElement:function(){return this.element},line:function(t,e,i,n,s){var r=this._createSVGElement("line");r.setAttribute("stroke",i),r.setAttribute("stroke-width",n),r.setAttribute("stroke-linecap",s),r.setAttribute("x1",t.x),r.setAttribute("y1",t.y),r.setAttribute("x2",e.x),r.setAttribute("y2",e.y),this.graphics.appendChild(r)},_createSVGElement:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},_createSVGCanvas:function(t,e){this.element=this._createSVGElement("svg"),this.element.setAttribute("width",t),this.element.setAttribute("height",e),this.graphics=this._createSVGElement("g"),this.element.appendChild(this.graphics)}},this.Drum.DownButton=function(e,i,n,s){var r={x:e/2,y:i-s},a={x:e,y:s},d={x:s,y:s},h=new t(e,i);h.line(d,r,n,s,"round"),h.line(r,a,n,s,"round");var o=document.createElement("div");return o.classList.add("dial"),o.classList.add("down"),o.appendChild(h.getElement()),o},this.Drum.UpButton=function(e,i,n,s){var r={x:e/2,y:s},a={x:e,y:i-s},d={x:s,y:i-s},h=new t(e,i);h.line(d,r,n,s,"round"),h.line(r,a,n,s,"round");var o=document.createElement("div");return o.classList.add("dial"),o.classList.add("up"),o.appendChild(h.getElement()),o}}();